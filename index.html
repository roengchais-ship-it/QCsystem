<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC System v6.3 (Full Feature Edit)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <style>
        /* --- THEME CONFIG --- */
        :root {
            --primary: #2c4b46;
            --primary-soft: #3d6e66;
            --active-green: #27ae60;
            --bg-body: #f0f2f5;
            --text-main: #2d3436;
            --text-light: #636e72;
            --border-input: #e0e0e0;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(44, 75, 70, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg-body); color: var(--text-main); line-height: 1.5; overflow-x: hidden; }
        .container { max-width: 1200px; margin: 0 auto; width: 100%; }

        /* --- Login Overlay --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, #1a2a28 100%);
            display: flex; justify-content: center; align-items: center; z-index: 10000;
        }
        .login-card {
            background: white; padding: 40px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            width: 90%; max-width: 400px; text-align: center; animation: fadeInDown 0.5s ease-out;
        }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .login-card h2 { margin-bottom: 10px; color: var(--primary); font-size: 1.8rem; }
        .login-card input {
            width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid #ddd;
            border-radius: 12px; font-family: 'Prompt'; font-size: 1rem; transition: 0.3s;
        }
        #loginError { color: #e74c3c; font-size: 0.85rem; margin-bottom: 15px; display: none; }

        /* --- Loading --- */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); display: none; justify-content: center; align-items: center; flex-direction: column; z-index: 9999; backdrop-filter: blur(5px); }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Header --- */
        .header { background: linear-gradient(120deg, var(--primary) 0%, var(--primary-soft) 100%); color: white; padding: 25px 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: var(--shadow-md); position: relative; }
        .user-panel { position: absolute; top: 15px; right: 20px; display: flex; align-items: center; gap: 10px; }
        .user-tag { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }

        /* --- Tabs --- */
        .tabs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .tab { padding: 12px 10px; background: white; border: none; border-radius: 12px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: var(--text-light); transition: all 0.2s ease; box-shadow: var(--shadow-sm); font-family: 'Prompt'; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab.active { background: var(--active-green); color: white; box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4); }
        .tab-content { display: none; background: white; padding: 25px; border-radius: 16px; box-shadow: var(--shadow-md); min-height: 400px; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Form Elements --- */
        .form-section { margin-bottom: 30px; padding: 20px; border-radius: 12px; background: #fcfcfc; border: 1px solid #f0f0f0; }
        .section-title { font-size: 1rem; font-weight: 600; color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid rgba(44, 75, 70, 0.1); padding-bottom: 8px; }
        .section-icon { background: rgba(44, 75, 70, 0.1); color: var(--primary); width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 0.9rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .form-group { position: relative; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 0.9rem; }
        .required { color: #e74c3c; margin-left: 2px; }
        .form-group input, .form-group select { width: 100%; padding: 10px 12px; border: 1px solid var(--border-input); border-radius: 10px; font-size: 0.95rem; font-family: 'Prompt'; transition: all 0.2s; }
        .form-group input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(44, 75, 70, 0.15); }

        /* Autocomplete */
        .autocomplete-list { position: absolute; z-index: 1000; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.15); max-height: 200px; overflow-y: auto; display: none; }
        .autocomplete-item { padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #f9f9f9; font-size: 0.9rem; }
        .autocomplete-item:hover { background: #f0f7f6; color: var(--primary); }

        .file-upload { border: 2px dashed #cbd5e0; padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; transition: 0.3s; background: #f8fafc; }
        .file-upload:hover { border-color: var(--primary); background: #f0f7f6; }

        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 6px; font-family: 'Prompt'; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-secondary { background: #636e72; color: white; }
        .btn-sm { padding: 6px 10px; font-size: 0.8rem; border-radius: 8px; }

        /* Table */
        .table-container-scroll { border-radius: 12px; overflow-x: auto; border: 1px solid #eee; margin-top: 15px; width: 100%; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #f8f9fa; color: var(--text-light); padding: 12px 10px; text-align: left; font-weight: 600; font-size: 0.85rem; }
        td { padding: 12px 10px; border-bottom: 1px solid #f0f0f0; color: var(--text-main); font-size: 0.9rem; }

        /* Dashboard & Charts */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .kpi-card { background: white; padding: 20px; border-radius: 14px; box-shadow: var(--shadow-sm); display: flex; align-items: center; justify-content: space-between; border-bottom: 4px solid var(--primary); }
        .kpi-info h3 { font-size: 0.8rem; color: var(--text-light); text-transform: uppercase; margin-bottom: 4px; }
        .kpi-info .value { font-size: 1.8rem; font-weight: 700; }
        .charts-row { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
        .chart-box { background: white; padding: 20px; border-radius: 16px; box-shadow: var(--shadow-sm); border: 1px solid #f5f5f5; }

        /* Status Badges */
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .pass { background: rgba(39, 174, 96, 0.15); color: #27ae60; }
        .fail { background: rgba(231, 76, 60, 0.15); color: #e74c3c; }
        .pending { background: rgba(243, 156, 18, 0.15); color: #f39c12; }
        .hold { background: rgba(149, 165, 166, 0.2); color: #7f8c8d; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 5000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 16px; width: 95%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative; }

        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } .tabs { grid-template-columns: repeat(2, 1fr); } .charts-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <!-- üîê Login Overlay -->
    <div id="login-overlay">
        <div class="login-card">
            <h2>üîê QC System Login</h2>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                <input type="text" id="loginUser" placeholder="Username" autocomplete="username">
                <input type="password" id="loginPass" placeholder="Password" autocomplete="current-password">
                <div id="loginError">Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
                <button type="submit" class="btn btn-primary" style="width:100%; padding: 14px;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (Enter)</button>
            </form>
        </div>
    </div>

    <!-- üîÑ Loading -->
    <div id="loading-overlay"><div class="spinner"></div><span id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span></div>

    <!-- üì± Main App -->
    <div id="main-app" style="display:none; padding: 15px;">
        <div class="container">
            <div class="header">
                <div class="user-panel">
                    <span class="user-tag" id="displayUser">User: -</span>
                    <button class="btn btn-warning btn-sm" onclick="openModal('passModal')">üîë ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™</button>
                    <button class="btn btn-danger btn-sm" onclick="handleLogout()">Logout</button>
                </div>
                <h1>‚òÅÔ∏è QC System v6.3</h1>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('form')"><span>üìù</span> Form</button>
                <button class="tab" onclick="showTab('master')"><span>üìä</span> History</button>
                <button class="tab" onclick="showTab('summary')"><span>üìà</span> Dash</button>
                <button class="tab" onclick="showTab('search')"><span>üîç</span> Search</button>
            </div>

            <!-- Tab: Form -->
            <div id="form" class="tab-content active">
                <form id="qcForm">
                    <!-- Section A -->
                    <div class="form-section">
                        <div class="section-title"><div class="section-icon">A</div> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (Raw Material)</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>RM Code <span class="required">*</span></label>
                                <input type="text" name="rmCode" id="rmCode" onkeyup="handleAutocomplete(event, 'rmCode')" required>
                                <div class="autocomplete-list" id="rmCode-autocomplete-list"></div>
                            </div>
                            <div class="form-group">
                                <label>RM Name <span class="required">*</span></label>
                                <input type="text" name="rmName" id="rmName" onkeyup="handleAutocomplete(event, 'rmName')" required>
                                <div class="autocomplete-list" id="rmName-autocomplete-list"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Supplier <span class="required">*</span></label><input type="text" name="supplier" required></div>
                            <div class="form-group"><label>Lot No. <span class="required">*</span></label><input type="text" name="lotNo" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Internal Lot</label><input type="text" name="internalLotNo"></div>
                            <div class="form-group"><label>Received Date <span class="required">*</span></label><input type="date" name="receivedDate" required></div>
                        </div>
                    </div>

                    <!-- Section B -->
                    <div class="form-section">
                        <div class="section-title"><div class="section-icon">B</div> ‡∏ú‡∏•‡∏à‡∏≤‡∏Å COA & ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</div>
                        <div class="form-row">
                            <div class="form-group"><label>‡∏™‡∏µ (COA Color)</label><input type="text" name="coaColor"></div>
                            <div class="form-group"><label>‡∏Å‡∏•‡∏¥‡πà‡∏ô (COA Odor)</label><input type="text" name="coaOdor"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>‡∏Ñ‡πà‡∏≤ pH (COA)</label><input type="text" name="coaPh"></div>
                            <div class="form-group"><label>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (COA Temp)</label><input type="text" name="coaTemp"></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;">
                            <label>‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå COA (PDF/‡∏£‡∏π‡∏õ)</label>
                            <div class="file-upload" onclick="document.getElementById('coaFile').click()">
                                <input type="file" id="coaFile" accept=".pdf,.jpg,.jpeg,.png" style="display:none"> 
                                <span style="font-size:1.5rem;">üìé</span>
                                <span id="fileName" style="color:#666; font-size:0.9rem; display:block;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå COA</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section C -->
                    <div class="form-section">
                        <div class="section-title"><div class="section-icon">C</div> ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Result)</div>
                        <div class="form-row">
                            <div class="form-group"><label>‡∏™‡∏µ (QC Color) <span class="required">*</span></label><input type="text" name="qcColor" required></div>
                            <div class="form-group"><label>‡∏Å‡∏•‡∏¥‡πà‡∏ô (QC Odor) <span class="required">*</span></label><input type="text" name="qcOdor" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>‡∏Ñ‡πà‡∏≤ pH (QC) <span class="required">*</span></label><input type="text" name="qcPh" required></div>
                            <div class="form-group"><label>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (QC) <span class="required">*</span></label><input type="text" name="qcTemp" required></div>
                        </div>
                        <div class="form-group" style="margin-bottom:15px;">
                            <label>üì∑ ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (QC Photo)</label>
                            <div class="file-upload" style="border-color:#27ae60; background:#f0fff4;" onclick="document.getElementById('qcFile').click()">
                                <input type="file" id="qcFile" accept=".jpg,.jpeg,.png" style="display:none"> 
                                <span style="font-size:1.5rem;">üì∏</span>
                                <span id="qcFileName" style="color:#27ae60; font-size:0.9rem; display:block;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ QC</span>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Result <span class="required">*</span></label>
                                <select name="passFail" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                    <option value="Pass">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô (Pass)</option>
                                    <option value="Fail">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (Fail)</option>
                                    <option value="Pending">‚è≥ ‡∏£‡∏≠‡∏ú‡∏• (Pending)</option>
                                    <option value="Hold">üîí ‡∏≠‡∏≤‡∏¢‡∏±‡∏î (Hold)</option>
                                </select>
                            </div>
                            <div class="form-group"><label>Approved By <span class="required">*</span></label><input type="text" name="approvedBy" required></div>
                        </div>
                        <div class="form-group"><label>Date <span class="required">*</span></label><input type="date" name="approvedDate" required></div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width:100%; padding:15px; font-size:1.1rem;">üöÄ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
            </div>

            <!-- Tab: History -->
            <div id="master" class="tab-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h2>üìä Inspection History</h2>
                    <div>
                        <button class="btn btn-success" onclick="exportToExcel()">üì• Excel</button>
                        <button class="btn btn-secondary" onclick="fetchData()">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="table-container-scroll">
                    <table>
                        <thead>
                            <tr><th>Date</th><th>RM Code</th><th>Lot No.</th><th>Result</th><th>COA</th><th>QC Pic</th><th>Action</th></tr>
                        </thead>
                        <tbody id="masterTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Dashboard -->
            <div id="summary" class="tab-content">
                <div class="dashboard-grid">
                    <div class="kpi-card"><div><div class="kpi-info"><h3>Total</h3><div class="value" id="dashTotal">0</div></div></div><div>üì¶</div></div>
                    <div class="kpi-card" style="border-bottom-color:#27ae60;"><div><div class="kpi-info"><h3>Pass</h3><div class="value" id="dashPass">0</div></div></div><div>‚úÖ</div></div>
                    <div class="kpi-card" style="border-bottom-color:#e74c3c;"><div><div class="kpi-info"><h3>Fail</h3><div class="value" id="dashFail">0</div></div></div><div>‚ùå</div></div>
                    <div class="kpi-card" style="border-bottom-color:#f39c12;"><div><div class="kpi-info"><h3>Rate</h3><div class="value" id="dashRate">0%</div></div></div><div>üìä</div></div>
                </div>
                <div class="charts-row">
                    <div class="chart-box">
                        <h3 style="margin-bottom:15px; font-size:1rem;">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3>
                        <canvas id="qcPieChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <h3 style="margin-bottom:15px; font-size:1rem;">‚è≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ú‡∏• (Aging)</h3>
                        <div class="table-container-scroll" style="margin-top:0;">
                            <table style="min-width:100%;">
                                <thead><tr><th>RM Code</th><th>Lot</th><th>Status</th><th>Aging</th></tr></thead>
                                <tbody id="dashPendingBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Search -->
            <div id="search" class="tab-content">
                <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ RM Code, Name, ‡∏´‡∏£‡∏∑‡∏≠ Lot..." style="width:100%; padding:15px; border-radius:30px; border:1px solid #eee; margin-bottom:25px;" oninput="performSearch()">
                <div id="searchResults"></div>
            </div>
        </div>
    </div>

    <!-- üîë Change Pass Modal -->
    <div id="passModal" class="modal">
        <div class="modal-content">
            <h3>üîë ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
            <div class="form-group" style="margin:15px 0;"><label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°</label><input type="password" id="oldPass"></div>
            <div class="form-group" style="margin:15px 0;"><label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label><input type="password" id="newPass"></div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn btn-primary" onclick="handleChangePassword()" style="flex:1;">‡∏ï‡∏Å‡∏•‡∏á</button>
                <button class="btn btn-secondary" onclick="closeModal('passModal')" style="flex:1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- ‚úèÔ∏è Edit Modal (Full Fields) -->
    <div id="editModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3 style="margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:10px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Full Edit)</h3>
            <form id="editForm">
                <input type="hidden" id="editOriginalTimestamp">
                
                <!-- Section A -->
                <div style="margin-bottom:15px; border:1px solid #eee; padding:10px; border-radius:8px;">
                    <div style="font-weight:bold; color:var(--primary); margin-bottom:10px;">A: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</div>
                    <div class="form-row">
                        <div class="form-group"><label>RM Code</label><input type="text" id="edit_rmCode" required></div>
                        <div class="form-group"><label>RM Name</label><input type="text" id="edit_rmName" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Supplier</label><input type="text" id="edit_supplier" required></div>
                        <div class="form-group"><label>Lot No.</label><input type="text" id="edit_lotNo" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Int. Lot</label><input type="text" id="edit_internalLotNo"></div>
                        <div class="form-group"><label>Rec. Date</label><input type="date" id="edit_receivedDate" required></div>
                    </div>
                </div>

                <!-- Section B -->
                <div style="margin-bottom:15px; border:1px solid #eee; padding:10px; border-radius:8px; background:#f9f9f9;">
                    <div style="font-weight:bold; color:var(--primary); margin-bottom:10px;">B: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• COA</div>
                    <div class="form-row">
                        <div class="form-group"><label>COA Color</label><input type="text" id="edit_coaColor"></div>
                        <div class="form-group"><label>COA Odor</label><input type="text" id="edit_coaOdor"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>COA pH</label><input type="text" id="edit_coaPh"></div>
                        <div class="form-group"><label>COA Temp</label><input type="text" id="edit_coaTemp"></div>
                    </div>
                    <div>
                        <label style="font-weight:600; font-size:0.85rem;">COA File:</label>
                        <div id="edit_coaFileStatus" style="font-size:0.8rem; margin:5px 0; color:#666;"></div>
                        <input type="file" id="edit_coaFileInput" style="font-size:0.8rem;">
                        <button type="button" id="edit_btnRemoveCoa" class="btn btn-danger btn-sm" onclick="markFileRemoved('coa')" style="display:none; margin-top:5px;">‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°</button>
                    </div>
                </div>

                <!-- Section C -->
                <div style="margin-bottom:15px; border:1px solid #eee; padding:10px; border-radius:8px;">
                    <div style="font-weight:bold; color:var(--primary); margin-bottom:10px;">C: ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                    <div class="form-row">
                        <div class="form-group"><label>QC Color</label><input type="text" id="edit_qcColor"></div>
                        <div class="form-group"><label>QC Odor</label><input type="text" id="edit_qcOdor"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>QC pH</label><input type="text" id="edit_qcPh"></div>
                        <div class="form-group"><label>QC Temp</label><input type="text" id="edit_qcTemp"></div>
                    </div>
                    <div>
                        <label style="font-weight:600; font-size:0.85rem;">QC Photo:</label>
                        <div id="edit_qcFileStatus" style="font-size:0.8rem; margin:5px 0; color:#666;"></div>
                        <input type="file" id="edit_qcFileInput" style="font-size:0.8rem;">
                        <button type="button" id="edit_btnRemoveQc" class="btn btn-danger btn-sm" onclick="markFileRemoved('qc')" style="display:none; margin-top:5px;">‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°</button>
                    </div>
                    <div class="form-row" style="margin-top:10px;">
                        <div class="form-group">
                            <label>Result</label>
                            <select id="edit_passFail" required>
                                <option value="Pass">Pass</option><option value="Fail">Fail</option>
                                <option value="Pending">Pending</option><option value="Hold">Hold</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Approved By</label><input type="text" id="edit_approvedBy"></div>
                    </div>
                    <div class="form-group"><label>Approved Date</label><input type="date" id="edit_approvedDate"></div>
                </div>

                <div style="text-align:center; display:flex; gap:10px;">
                    <button type="submit" class="btn btn-primary" style="flex:2;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button type="button" class="btn btn-secondary" style="flex:1;" onclick="closeModal('editModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwdpL4fbmZg3lrLR2XCpCMqrU7Ee_893AEuD_3Oc8Qi6q7bC0m0FIZQ3rEV3TJ3zKufAQ/exec";
        
        const MASTER_LIST = [
            { code: "RM1-SV-WT", name: "Water" }, { code: "RM2-CA-LRGS", name: "Plantacare 1200 UP" },
            { code: "RM2-CA-DG-DGS", name: "Plantacare 2000 UP" }, { code: "RM2-CA-CGS", name: "Plantacare 810 UP" },
            { code: "RM2-CA-SCG", name: "Galsoft SCG" }, { code: "RM2-CA-CG-GO", name: "LAMESOFT PO 65" },
            { code: "RM2-CA-DHY", name: "Dehyton K/I5" }, { code: "RM2-HT-ABLE", name: "Organic aloe vera extract" },
            { code: "RM2-HT-WTE", name: "White tea extract" }, { code: "RM2-HT-SPCA", name: "Ajidew NL-50 (Sodium PCA)" },
            { code: "RM2-HT-PPG20", name: "Glucam P-20" }, { code: "RM2-HT-GCR", name: "Glycerine 99.7% USP Food Grade" },
            { code: "RM3-SR-LPEZ", name: "Lipase enzyme" }, { code: "RM3-SR-VCM", name: "Aristocare Smart" },
            { code: "RM2-AO-PSME-BA210", name: "Pancil BA-210" }, { code: "RM2-AO-PSME-V20", name: "Pancil V-20" },
            { code: "RM2-AO-PSME-FG70", name: "Pancil FG-70" }, { code: "RM2-AO-DKE", name: "Pancil TOA-1" },
            { code: "RM2-PT-SDB", name: "Sodium benzoate" }, { code: "RM-CTA-8HQ", name: "8-HQ" },
            { code: "RM2-PH-LTA", name: "Lactic acid" }, { code: "RM2-PH-CTA", name: "Citric acid" },
            { code: "RM2-CTA-2EDTA", name: "Disodium EDTA" }, { code: "RM2-SV-ETN", name: "Sciwis" },
            { code: "RM2-SV-ETN95", name: "DEB 95 (Ethyl alcohol 95% v/v)" },
            { code: "RM2-SV-DPM", name: "Dipropylene Glycol Monomethyl Ether (DPM)" },
            { code: "RM2-EM-DPG", name: "Dipropylene glycol" }, { code: "RM2-PF-PF", name: "Pine Forest Perfume" },
            { code: "RM2-PF-WTR", name: "White Tea Retreats Perfume" }, { code: "RM2-PF-NG", name: "Neroli Garden Perfume" },
            { code: "RM2-PF-CLR", name: "Chalene Rose Perfume" }, { code: "RM2-PF-ST", name: "Serene Tea Perfume" },
            { code: "RM2-PF-CM", name: "Cotton Musk Perfume" }, { code: "RM2-PF-WM", name: "Wild Mint Perfume" },
            { code: "RM2-PF-CTF", name: "Citropol F" }, { code: "RM2-PF-BPL", name: "Black pepper oil" },
            { code: "RM2-PT-RDFE", name: "Koprafinol" }, { code: "RM2-PT-KOP", name: "Kopcerin PE1090" },
            { code: "RM2-PT-STS", name: "Sodium thiosulfate" }, { code: "RM1-OT-SG", name: "Sucrose" },
            { code: "RM2-EM-PG40", name: "Eumulgin CO 40" }, { code: "RM2-EM-IPM", name: "Isopropyl myristate (IPM)" }
        ];

        let inspections = [];
        let currentUser = null;
        let myPieChart = null;
        let currentCoaFileData = null;
        let currentQcFileData = null;
        
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Edit
        let editCoaFileData = null;
        let editQcFileData = null;
        let isEditCoaRemoved = false;
        let isEditQcRemoved = false;

        // --- üîê AUTH ---
        if (!localStorage.getItem('qc_users')) localStorage.setItem('qc_users', JSON.stringify({'qc':'1234','admin':'1234'}));

        function handleLogin() {
            const u = document.getElementById('loginUser').value.trim();
            const p = document.getElementById('loginPass').value.trim();
            const users = JSON.parse(localStorage.getItem('qc_users'));
            if (users[u] && users[u] === p) {
                currentUser = u;
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('displayUser').textContent = "User: " + u;
                fetchData();
            } else { document.getElementById('loginError').style.display = 'block'; }
        }

        function handleLogout() { location.reload(); }

        function handleChangePassword() {
            const oldP = document.getElementById('oldPass').value;
            const newP = document.getElementById('newPass').value;
            const users = JSON.parse(localStorage.getItem('qc_users'));
            if (users[currentUser] === oldP) {
                users[currentUser] = newP;
                localStorage.setItem('qc_users', JSON.stringify(users));
                alert("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); closeModal('passModal');
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
        }

        // --- üìä DATA ---
        async function fetchData() {
            showLoading(true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
            try {
                const res = await fetch(WEB_APP_URL);
                const data = await res.json();
                inspections = data.reverse();
                renderMasterTable();
                renderSummary();
            } catch (e) { alert("Error connecting to server"); }
            showLoading(false);
        }

        document.getElementById('qcForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading(true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...");
            const fd = new FormData(this);
            const data = {
                action: 'insert',
                timestamp: new Date().toLocaleString('th-TH'),
                rmCode: fd.get('rmCode'), rmName: fd.get('rmName'), supplier: fd.get('supplier'), lotNo: fd.get('lotNo'), internalLotNo: fd.get('internalLotNo'),
                receivedDate: fd.get('receivedDate'), coaColor: fd.get('coaColor'), coaOdor: fd.get('coaOdor'), coaPh: fd.get('coaPh'), coaTemp: fd.get('coaTemp'),
                qcColor: fd.get('qcColor'), qcOdor: fd.get('qcOdor'), qcPh: fd.get('qcPh'), qcTemp: fd.get('qcTemp'),
                passFail: fd.get('passFail'), approvedBy: fd.get('approvedBy'), approvedDate: fd.get('approvedDate'),
                coaFile: currentCoaFileData, qcFile: currentQcFileData
            };
            try {
                await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(data) });
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); this.reset(); currentCoaFileData = null; currentQcFileData = null;
                document.getElementById('fileName').textContent = "‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå COA";
                document.getElementById('qcFileName').textContent = "‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ QC";
                fetchData();
            } catch (err) { alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß"); fetchData(); }
            showLoading(false);
        });

        // --- üñ•Ô∏è UI RENDER ---
        function renderMasterTable() {
            const tbody = document.getElementById('masterTableBody');
            tbody.innerHTML = inspections.map((item, idx) => `
                <tr>
                    <td>${item.receivedDate}</td>
                    <td><strong>${item.rmCode}</strong><br><small>${item.rmName}</small></td>
                    <td>${item.lotNo}</td>
                    <td><span class="status-badge ${item.passFail.toLowerCase()}">${item.passFail}</span></td>
                    <td>${item.coaFile?.isLink ? `<a href="${item.coaFile.data}" target="_blank" class="btn btn-secondary btn-sm">COA</a>` : '-'}</td>
                    <td>${item.qcFile?.isLink ? `<a href="${item.qcFile.data}" target="_blank" class="btn btn-success btn-sm">Pic</a>` : '-'}</td>
                    <td><button class="btn btn-warning btn-sm" onclick="openEditRecord(${idx})">‚úèÔ∏è</button></td>
                </tr>
            `).join('');
        }

        function renderSummary() {
            const total = inspections.length;
            const pass = inspections.filter(i => i.passFail === 'Pass').length;
            const fail = inspections.filter(i => i.passFail === 'Fail').length;
            const pendingItems = inspections.filter(i => i.passFail === 'Pending' || i.passFail === 'Hold');
            
            document.getElementById('dashTotal').textContent = total;
            document.getElementById('dashPass').textContent = pass;
            document.getElementById('dashFail').textContent = fail;
            document.getElementById('dashRate').textContent = total > 0 ? ((pass/total)*100).toFixed(0)+'%' : '0%';

            document.getElementById('dashPendingBody').innerHTML = pendingItems.map(i => {
                const days = Math.floor((new Date() - new Date(i.receivedDate)) / (1000*60*60*24));
                return `<tr><td>${i.rmCode}</td><td>${i.lotNo}</td><td>${i.passFail}</td><td style="color:${days>7?'red':'green'}"><b>${days} ‡∏ß‡∏±‡∏ô</b></td></tr>`;
            }).join('');

            if (myPieChart) myPieChart.destroy();
            myPieChart = new Chart(document.getElementById('qcPieChart'), {
                type: 'doughnut', plugins: [ChartDataLabels],
                data: { labels: ['Pass', 'Fail', 'Pending'], datasets: [{ data: [pass, fail, pendingItems.length], backgroundColor: ['#27ae60', '#e74c3c', '#f39c12'] }] },
                options: { plugins: { legend: { position: 'bottom' }, datalabels: { color: '#fff' } } }
            });
        }

        function performSearch() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const res = inspections.filter(i => i.rmCode.toLowerCase().includes(q) || i.lotNo.toLowerCase().includes(q));
            document.getElementById('searchResults').innerHTML = res.map(i => `
                <div class="result-card">
                    <div class="result-header">
                        <strong>${i.rmCode}</strong><span class="lot-badge">Lot: ${i.lotNo}</span>
                        <span class="status-badge ${i.passFail.toLowerCase()}">${i.passFail}</span>
                    </div>
                    <div class="result-content">
                        <div class="info-box"><span class="info-label">Name</span>${i.rmName}</div>
                        <div class="info-box"><span class="info-label">Approved</span>${i.approvedBy} (${i.approvedDate})</div>
                    </div>
                </div>
            `).join('');
        }

        // --- üõ†Ô∏è HELPERS ---
        function showTab(id) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelector(`.tab[onclick*="${id}"]`).classList.add('active');
        }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function showLoading(s, t) { document.getElementById('loading-overlay').style.display = s ? 'flex' : 'none'; document.getElementById('loading-text').textContent = t || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...'; }

        function readFile(input, cb) {
            const f = input.files[0];
            if(f) { const r = new FileReader(); r.onload = e => cb({name: f.name, data: e.target.result}); r.readAsDataURL(f); }
        }

        document.getElementById('coaFile').onchange = e => readFile(e.target, d => { currentCoaFileData = d; document.getElementById('fileName').textContent = "üì¶ " + d.name; });
        document.getElementById('qcFile').onchange = e => readFile(e.target, d => { currentQcFileData = d; document.getElementById('qcFileName').textContent = "üì∏ " + d.name; });

        function handleAutocomplete(e, f) {
            const list = document.getElementById(f + '-autocomplete-list');
            const v = e.target.value.toLowerCase();
            if(v.length < 1) { list.style.display = 'none'; return; }
            const matches = MASTER_LIST.filter(i => i.code.toLowerCase().includes(v) || i.name.toLowerCase().includes(v)).slice(0, 5);
            list.innerHTML = matches.map(m => `<div class="autocomplete-item" onclick="selectRM('${m.code}', '${m.name}')">${m.code} - ${m.name}</div>`).join('');
            list.style.display = matches.length ? 'block' : 'none';
        }
        function selectRM(c, n) { document.getElementById('rmCode').value = c; document.getElementById('rmName').value = n; document.querySelectorAll('.autocomplete-list').forEach(l => l.style.display = 'none'); }

        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(inspections.map(i => ({...i, coaFile: i.coaFile?.data||'-', qcFile: i.qcFile?.data||'-'})));
            const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "QC"); XLSX.writeFile(wb, "QC_Report.xlsx");
        }

        // --- ‚úèÔ∏è EDIT LOGIC ---
        function openEditRecord(idx) {
            const i = inspections[idx];
            document.getElementById('editOriginalTimestamp').value = i.timestamp;
            
            // Populating fields
            const fields = ['rmCode','rmName','supplier','lotNo','internalLotNo','receivedDate','coaColor','coaOdor','coaPh','coaTemp','qcColor','qcOdor','qcPh','qcTemp','passFail','approvedBy','approvedDate'];
            fields.forEach(f => { if(document.getElementById('edit_'+f)) document.getElementById('edit_'+f).value = i[f] || ''; });
            
            // File Status COA
            isEditCoaRemoved = false; editCoaFileData = null;
            if(i.coaFile?.isLink) {
                document.getElementById('edit_coaFileStatus').innerHTML = `<a href="${i.coaFile.data}" target="_blank">üìÑ ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</a>`;
                document.getElementById('edit_btnRemoveCoa').style.display = "block";
            } else {
                document.getElementById('edit_coaFileStatus').textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö";
                document.getElementById('edit_btnRemoveCoa').style.display = "none";
            }
            
            // File Status QC
            isEditQcRemoved = false; editQcFileData = null;
            if(i.qcFile?.isLink) {
                document.getElementById('edit_qcFileStatus').innerHTML = `<a href="${i.qcFile.data}" target="_blank">üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</a>`;
                document.getElementById('edit_btnRemoveQc').style.display = "block";
            } else {
                document.getElementById('edit_qcFileStatus').textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ô‡∏ö";
                document.getElementById('edit_btnRemoveQc').style.display = "none";
            }
            
            openModal('editModal');
        }

        function markFileRemoved(type) {
            if(type === 'coa') { isEditCoaRemoved = true; document.getElementById('edit_coaFileStatus').textContent = "‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏•‡∏ö (‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"; document.getElementById('edit_btnRemoveCoa').style.display = "none"; }
            else { isEditQcRemoved = true; document.getElementById('edit_qcFileStatus').textContent = "‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏•‡∏ö (‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"; document.getElementById('edit_btnRemoveQc').style.display = "none"; }
        }

        document.getElementById('edit_coaFileInput').onchange = e => readFile(e.target, d => { editCoaFileData = d; document.getElementById('edit_coaFileStatus').textContent = "üÜï ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà: " + d.name; isEditCoaRemoved = false; });
        document.getElementById('edit_qcFileInput').onchange = e => readFile(e.target, d => { editQcFileData = d; document.getElementById('edit_qcFileStatus').textContent = "üÜï ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà: " + d.name; isEditQcRemoved = false; });

        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading(true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
            
            const data = {
                action: 'edit',
                originalTimestamp: document.getElementById('editOriginalTimestamp').value,
                rmCode: document.getElementById('edit_rmCode').value,
                rmName: document.getElementById('edit_rmName').value,
                supplier: document.getElementById('edit_supplier').value,
                lotNo: document.getElementById('edit_lotNo').value,
                internalLotNo: document.getElementById('edit_internalLotNo').value,
                receivedDate: document.getElementById('edit_receivedDate').value,
                coaColor: document.getElementById('edit_coaColor').value,
                coaOdor: document.getElementById('edit_coaOdor').value,
                coaPh: document.getElementById('edit_coaPh').value,
                coaTemp: document.getElementById('edit_coaTemp').value,
                qcColor: document.getElementById('edit_qcColor').value,
                qcOdor: document.getElementById('edit_qcOdor').value,
                qcPh: document.getElementById('edit_qcPh').value,
                qcTemp: document.getElementById('edit_qcTemp').value,
                passFail: document.getElementById('edit_passFail').value,
                approvedBy: document.getElementById('edit_approvedBy').value,
                approvedDate: document.getElementById('edit_approvedDate').value,
                // Files
                coaFile: editCoaFileData,
                qcFile: editQcFileData,
                isFileRemoved: isEditCoaRemoved,
                isQcFileRemoved: isEditQcRemoved
            };

            try {
                await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(data) });
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                closeModal('editModal');
                fetchData();
            } catch (err) { alert("‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); fetchData(); closeModal('editModal'); }
            showLoading(false);
        });

        window.onclick = e => { if(e.target.classList.contains('modal')) document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); };
    </script>
</body>
</html>
